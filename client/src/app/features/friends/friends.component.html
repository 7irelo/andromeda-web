<div class="friends-page">
  <div class="page-header-gradient">
    <h1>Find Friends</h1>
    <p style="opacity:.8;margin-top:4px;font-size:14px">Discover people you may know</p>
  </div>

  <!-- Search -->
  <div class="search-bar">
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Search people</mat-label>
      <input matInput [(ngModel)]="searchQuery" (input)="search()" placeholder="Name, username..." />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <!-- Search Results -->
  <div *ngIf="searchResults.length > 0">
    <h2>Search Results</h2>
    <div class="user-grid">
      <div class="user-card-lg card" *ngFor="let user of searchResults">
        <div class="user-card-cover">
          <img *ngIf="user.cover_photo_url" [src]="user.cover_photo_url" alt="" class="cover-img" />
        </div>
        <div class="user-card-body">
          <img [src]="user.avatar_url || 'assets/default-avatar.png'" class="avatar lg user-float-avatar" [alt]="user.username" />
          <div class="font-semibold">{{ user.full_name }}</div>
          <div class="text-secondary text-sm">&#64;{{ user.username }}</div>
          <ng-container *ngIf="!user.is_friend">
            <button mat-flat-button color="primary" (click)="addFriend(user)" class="w-full"
                    [disabled]="user.friend_request_sent">
              <mat-icon>{{ user.friend_request_sent ? 'check' : 'person_add' }}</mat-icon>
              {{ user.friend_request_sent ? 'Request Sent' : 'Add Friend' }}
            </button>
          </ng-container>
          <ng-container *ngIf="user.is_friend">
            <span class="text-secondary text-sm">Already friends</span>
          </ng-container>
          <a mat-button [routerLink]="'/profile/' + user.username" class="w-full">View Profile</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Pending Requests -->
  <div *ngIf="friendRequests.length > 0">
    <h2>Friend Requests ({{ friendRequests.length }})</h2>
    <div class="user-grid">
      <div class="user-card-lg card" *ngFor="let req of friendRequests">
        <div class="user-card-cover">
          <img *ngIf="req.sender.cover_photo_url" [src]="req.sender.cover_photo_url" alt="" class="cover-img" />
        </div>
        <div class="user-card-body">
          <img [src]="req.sender.avatar_url || 'assets/default-avatar.png'" class="avatar lg user-float-avatar" [alt]="req.sender.username" />
          <div class="font-semibold">{{ req.sender.full_name }}</div>
          <div class="text-secondary text-sm">&#64;{{ req.sender.username }}</div>
          <div class="request-actions">
            <button mat-flat-button color="primary" (click)="accept(req)" class="w-full">Confirm</button>
            <button mat-stroked-button (click)="decline(req)" class="w-full">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Suggestions -->
  <div>
    <h2>People You May Know</h2>
    <div *ngIf="loading" class="loading-center"><mat-spinner diameter="40"></mat-spinner></div>
    <div class="user-grid" *ngIf="!loading">
      <div class="user-card-lg card" *ngFor="let user of suggestions">
        <div class="user-card-cover">
          <img *ngIf="user.cover_photo_url" [src]="user.cover_photo_url" alt="" class="cover-img" />
        </div>
        <div class="user-card-body">
          <img [src]="user.avatar_url || 'assets/default-avatar.png'" class="avatar lg user-float-avatar" [alt]="user.username" />
          <div class="font-semibold">{{ user.full_name }}</div>
          <div class="text-secondary text-sm">&#64;{{ user.username }}</div>
          <button mat-flat-button color="primary" (click)="addFriend(user)" class="w-full"
                  [disabled]="user.friend_request_sent">
            <mat-icon>{{ user.friend_request_sent ? 'check' : 'person_add' }}</mat-icon>
            {{ user.friend_request_sent ? 'Request Sent' : 'Add Friend' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
